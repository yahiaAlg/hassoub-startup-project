<!DOCTYPE html>
<html lang="en">
{% load static %}
  <head>
    <meta name="x-poe-datastore-behavior" content="local_only" />
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://code.jquery.com https://unpkg.com https://d3js.org https://threejs.org https://cdn.plot.ly https://stackpath.bootstrapcdn.com https://maps.googleapis.com https://cdn.tailwindcss.com https://ajax.googleapis.com https://kit.fontawesome.com https://cdn.datatables.net https://maxcdn.bootstrapcdn.com https://code.highcharts.com https://tako-static-assets-production.s3.amazonaws.com https://www.youtube.com https://fonts.googleapis.com https://fonts.gstatic.com https://pfst.cf2.poecdn.net https://puc.poecdn.net https://i.imgur.com https://wikimedia.org https://*.icons8.com https://*.giphy.com https://picsum.photos https://images.unsplash.com; frame-src 'self' https://www.youtube.com https://trytako.com; child-src 'self'; manifest-src 'self'; worker-src 'self'; upgrade-insecure-requests; block-all-mixed-content;"
    />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Toy Store Tycoon - BizKids Learning Platform</title>
    <link rel="stylesheet" href="{% static "css/scenarios/toy-store-tycoon.css" %}" />
    <script src="https://puc.poecdn.net/authenticated_preview_page/syncedState.3f7572448765332f3047.js"></script>
  </head>
  <body>
    <!-- Game Header -->
    <header class="game-header">
      <div class="header-content">
        <div class="game-title">
          <span style="font-size: 2.5rem">üß∏</span>
          <h1>Toy Store Tycoon</h1>
        </div>
        <a href="games.html" class="back-link">
          <span>‚Üê</span>
          <span>Back to Games</span>
        </a>
      </div>
    </header>

    <!-- Progress Bar -->
    <div class="progress-container">
      <div class="progress-content">
        <div class="progress-steps">
          <div class="progress-line">
            <div
              class="progress-line-fill"
              id="progressFill"
              style="width: 0%"
            ></div>
          </div>
          <div class="step active" data-step="1">
            <div class="step-circle">1</div>
            <div class="step-label">Location</div>
          </div>
          <div class="step" data-step="2">
            <div class="step-circle">2</div>
            <div class="step-label">Inventory</div>
          </div>
          <div class="step" data-step="3">
            <div class="step-circle">3</div>
            <div class="step-label">Labor</div>
          </div>
          <div class="step" data-step="4">
            <div class="step-circle">4</div>
            <div class="step-label">Pricing</div>
          </div>
          <div class="step" data-step="5">
            <div class="step-circle">5</div>
            <div class="step-label">Marketing</div>
          </div>
          <div class="step" data-step="6">
            <div class="step-circle">6</div>
            <div class="step-label">Results</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Container -->
    <div class="main-container">
      <!-- Step 1: Location -->
      <div class="step-content active" id="step1">
        <div class="content-card">
          <h2 class="step-title">
            <span>üìç</span>
            <span>Choose Your Location</span>
          </h2>
          <p class="step-subtitle">
            Where will you set up your toy store? Each location has different
            costs and customer demographics.
          </p>

          <div class="edu-note">
            <div class="edu-note-title">
              <span>üí°</span>
              <span>Business Lesson:</span>
            </div>
            <div class="edu-note-content">
              Location affects your costs AND your customers! High-traffic areas
              cost more but bring more potential buyers. Think about who your
              customers will be.
            </div>
          </div>

          <div class="location-grid">
            <div class="location-card" onclick="selectLocation('mall')">
              <div class="location-icon">üè¨</div>
              <div class="location-name">Shopping Mall</div>
              <div class="location-cost">$200/month</div>
              <div class="location-details">
                <div class="detail-row">
                  <span class="detail-label">Foot Traffic:</span>
                  <span class="detail-value">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê Very High</span>
                </div>
                <div class="detail-row">
                  <span class="detail-label">Demographics:</span>
                  <span class="detail-value">All ages (3-15)</span>
                </div>
                <div class="detail-row">
                  <span class="detail-label">Spending Power:</span>
                  <span class="detail-value">High</span>
                </div>
              </div>
              <div class="pros-cons">
                <div class="pro">‚úì Maximum exposure &amp; customers</div>
                <div class="pro">‚úì Premium items sell well</div>
                <div class="con">‚úó Highest rent - need strong sales</div>
                <div class="con">‚úó Competition from other stores</div>
              </div>
            </div>

            <div class="location-card" onclick="selectLocation('downtown')">
              <div class="location-icon">üèôÔ∏è</div>
              <div class="location-name">Downtown Street</div>
              <div class="location-cost">$120/month</div>
              <div class="location-details">
                <div class="detail-row">
                  <span class="detail-label">Foot Traffic:</span>
                  <span class="detail-value">‚≠ê‚≠ê‚≠ê‚≠ê High</span>
                </div>
                <div class="detail-row">
                  <span class="detail-label">Demographics:</span>
                  <span class="detail-value">Mixed (5-12)</span>
                </div>
                <div class="detail-row">
                  <span class="detail-label">Spending Power:</span>
                  <span class="detail-value">Medium-High</span>
                </div>
              </div>
              <div class="pros-cons">
                <div class="pro">‚úì Good traffic at fair price</div>
                <div class="pro">‚úì Loyal local customers</div>
                <div class="con">‚úó Moderate competition</div>
                <div class="con">‚úó Need balanced product mix</div>
              </div>
            </div>

            <div class="location-card" onclick="selectLocation('neighborhood')">
              <div class="location-icon">üèòÔ∏è</div>
              <div class="location-name">Neighborhood Corner</div>
              <div class="location-cost">$60/month</div>
              <div class="location-details">
                <div class="detail-row">
                  <span class="detail-label">Foot Traffic:</span>
                  <span class="detail-value">‚≠ê‚≠ê‚≠ê Medium</span>
                </div>
                <div class="detail-row">
                  <span class="detail-label">Demographics:</span>
                  <span class="detail-value">Young kids (3-8)</span>
                </div>
                <div class="detail-row">
                  <span class="detail-label">Spending Power:</span>
                  <span class="detail-value">Low-Medium</span>
                </div>
              </div>
              <div class="pros-cons">
                <div class="pro">‚úì Low rent = easier profit</div>
                <div class="pro">‚úì Family-friendly atmosphere</div>
                <div class="con">‚úó Fewer total customers</div>
                <div class="con">‚úó Budget-conscious buyers</div>
              </div>
            </div>
          </div>

          <div class="action-buttons">
            <button
              class="btn btn-primary"
              onclick="nextStep()"
              id="step1Next"
              disabled=""
            >
              <span>Continue</span>
              <span>‚Üí</span>
            </button>
          </div>
        </div>
      </div>

      <!-- Step 2: Inventory -->
      <div class="step-content" id="step2">
        <div style="display: grid; grid-template-columns: 1fr 400px; gap: 2rem">
          <div>
            <div class="content-card">
              <h2 class="step-title">
                <span>üì¶</span>
                <span>Select Your Inventory</span>
              </h2>
              <p class="step-subtitle">
                Choose which toys to stock. Balance variety with your budget!
              </p>

              <div class="edu-note">
                <div class="edu-note-title">
                  <span>üí°</span>
                  <span>Business Lesson:</span>
                </div>
                <div class="edu-note-content">
                  Different products = different speeds and margins. Balance is
                  key! Fast sellers bring quick cash, premium items bring higher
                  profits.
                </div>
              </div>

              <div class="inventory-grid">
                <!-- Rubber Balls -->
                <div class="inventory-item">
                  <div class="inventory-header">
                    <div class="inventory-info">
                      <div class="inventory-name">
                        <span>‚öΩ</span>
                        <span>Rubber Balls</span>
                      </div>
                      <div class="inventory-cost">$1.00 each</div>
                    </div>
                  </div>
                  <div class="inventory-specs">
                    <div class="spec-item">
                      <div class="spec-label">Appeal</div>
                      <div class="spec-value">Ages 3-6</div>
                    </div>
                    <div class="spec-item">
                      <div class="spec-label">Sell Speed</div>
                      <div class="spec-value">‚ö° Very Fast</div>
                    </div>
                    <div class="spec-item">
                      <div class="spec-label">Margin</div>
                      <div class="spec-value">üí∞ Low</div>
                    </div>
                    <div class="spec-item">
                      <div class="spec-label">Suggested</div>
                      <div class="spec-value">$2.50-$4.00</div>
                    </div>
                  </div>
                  <div class="quantity-controls">
                    <button
                      class="quantity-btn"
                      onclick="adjustInventory('balls', -5)"
                    >
                      -
                    </button>
                    <div class="quantity-display">
                      <div class="quantity-number" id="ballsQty">0</div>
                      <div class="quantity-cost" id="ballsCost">$0.00</div>
                    </div>
                    <button
                      class="quantity-btn"
                      onclick="adjustInventory('balls', 5)"
                    >
                      +
                    </button>
                  </div>
                </div>

                <!-- Plush Animals -->
                <div class="inventory-item">
                  <div class="inventory-header">
                    <div class="inventory-info">
                      <div class="inventory-name">
                        <span>üß∏</span>
                        <span>Plush Animals</span>
                      </div>
                      <div class="inventory-cost">$5.00 each</div>
                    </div>
                  </div>
                  <div class="inventory-specs">
                    <div class="spec-item">
                      <div class="spec-label">Appeal</div>
                      <div class="spec-value">Ages 5-10</div>
                    </div>
                    <div class="spec-item">
                      <div class="spec-label">Sell Speed</div>
                      <div class="spec-value">‚ö° Fast</div>
                    </div>
                    <div class="spec-item">
                      <div class="spec-label">Margin</div>
                      <div class="spec-value">üí∞ Medium</div>
                    </div>
                    <div class="spec-item">
                      <div class="spec-label">Suggested</div>
                      <div class="spec-value">$12-$18</div>
                    </div>
                  </div>
                  <div class="quantity-controls">
                    <button
                      class="quantity-btn"
                      onclick="adjustInventory('plush', -5)"
                    >
                      -
                    </button>
                    <div class="quantity-display">
                      <div class="quantity-number" id="plushQty">0</div>
                      <div class="quantity-cost" id="plushCost">$0.00</div>
                    </div>
                    <button
                      class="quantity-btn"
                      onclick="adjustInventory('plush', 5)"
                    >
                      +
                    </button>
                  </div>
                </div>

                <!-- Board Games -->
                <div class="inventory-item">
                  <div class="inventory-header">
                    <div class="inventory-info">
                      <div class="inventory-name">
                        <span>üé≤</span>
                        <span>Board Games</span>
                      </div>
                      <div class="inventory-cost">$12.00 each</div>
                    </div>
                  </div>
                  <div class="inventory-specs">
                    <div class="spec-item">
                      <div class="spec-label">Appeal</div>
                      <div class="spec-value">Ages 8-14</div>
                    </div>
                    <div class="spec-item">
                      <div class="spec-label">Sell Speed</div>
                      <div class="spec-value">‚ö° Medium</div>
                    </div>
                    <div class="spec-item">
                      <div class="spec-label">Margin</div>
                      <div class="spec-value">üí∞ High</div>
                    </div>
                    <div class="spec-item">
                      <div class="spec-label">Suggested</div>
                      <div class="spec-value">$25-$35</div>
                    </div>
                  </div>
                  <div class="quantity-controls">
                    <button
                      class="quantity-btn"
                      onclick="adjustInventory('games', -5)"
                    >
                      -
                    </button>
                    <div class="quantity-display">
                      <div class="quantity-number" id="gamesQty">0</div>
                      <div class="quantity-cost" id="gamesCost">$0.00</div>
                    </div>
                    <button
                      class="quantity-btn"
                      onclick="adjustInventory('games', 5)"
                    >
                      +
                    </button>
                  </div>
                </div>

                <!-- RC Cars -->
                <div class="inventory-item">
                  <div class="inventory-header">
                    <div class="inventory-info">
                      <div class="inventory-name">
                        <span>üöó</span>
                        <span>RC Cars</span>
                      </div>
                      <div class="inventory-cost">$25.00 each</div>
                    </div>
                  </div>
                  <div class="inventory-specs">
                    <div class="spec-item">
                      <div class="spec-label">Appeal</div>
                      <div class="spec-value">Ages 10-15</div>
                    </div>
                    <div class="spec-item">
                      <div class="spec-label">Sell Speed</div>
                      <div class="spec-value">‚ö° Slow</div>
                    </div>
                    <div class="spec-item">
                      <div class="spec-label">Margin</div>
                      <div class="spec-value">üí∞ Very High</div>
                    </div>
                    <div class="spec-item">
                      <div class="spec-label">Suggested</div>
                      <div class="spec-value">$60-$75</div>
                    </div>
                  </div>
                  <div class="quantity-controls">
                    <button
                      class="quantity-btn"
                      onclick="adjustInventory('rc', -1)"
                    >
                      -
                    </button>
                    <div class="quantity-display">
                      <div class="quantity-number" id="rcQty">0</div>
                      <div class="quantity-cost" id="rcCost">$0.00</div>
                    </div>
                    <button
                      class="quantity-btn"
                      onclick="adjustInventory('rc', 1)"
                    >
                      +
                    </button>
                  </div>
                </div>
              </div>

              <div class="action-buttons">
                <button class="btn btn-secondary" onclick="prevStep()">
                  <span>‚Üê</span>
                  <span>Back</span>
                </button>
                <button
                  class="btn btn-primary"
                  onclick="nextStep()"
                  id="step2Next"
                >
                  <span>Continue</span>
                  <span>‚Üí</span>
                </button>
              </div>
            </div>
          </div>

          <div>
            <div class="summary-panel" id="summaryPanel">
              <div class="summary-title">
                <span>üìä</span>
                <span>Budget Summary</span>
              </div>
              <div class="summary-row">
                <span class="summary-label">Starting Budget:</span>
                <span class="summary-value">$500.00</span>
              </div>
              <div class="summary-row">
                <span class="summary-label">Location Rent:</span>
                <span class="summary-value" id="summaryRent">$0.00</span>
              </div>
              <div class="summary-row">
                <span class="summary-label">Inventory Cost:</span>
                <span class="summary-value" id="summaryInventory">$0.00</span>
              </div>
              <div class="summary-row" id="laborRow" style="display: none">
                <span class="summary-label">Labor Cost:</span>
                <span class="summary-value" id="summaryLabor">$0.00</span>
              </div>
              <div class="summary-row" id="marketingRow" style="display: none">
                <span class="summary-label">Marketing Cost:</span>
                <span class="summary-value" id="summaryMarketing">$0.00</span>
              </div>
              <div class="summary-total">
                <div class="summary-row">
                  <span class="summary-label">Total Costs:</span>
                  <span class="summary-value" id="summaryTotal">$0.00</span>
                </div>
                <div class="summary-row">
                  <span class="summary-label">Remaining:</span>
                  <span class="summary-value" id="summaryRemaining"
                    >$500.00</span
                  >
                </div>
              </div>
              <div id="budgetStatus"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Step 3: Labor -->
      <div class="step-content" id="step3">
        <div style="display: grid; grid-template-columns: 1fr 400px; gap: 2rem">
          <div>
            <div class="content-card">
              <h2 class="step-title">
                <span>üë•</span>
                <span>Hire Help?</span>
              </h2>
              <p class="step-subtitle">
                Will you work alone or hire an assistant? More help means more
                customers served.
              </p>

              <div class="edu-note">
                <div class="edu-note-title">
                  <span>üí°</span>
                  <span>Business Lesson:</span>
                </div>
                <div class="edu-note-content">
                  Labor costs increase capacity but reduce profit. Is it worth
                  it? Think about how many customers you can serve and whether
                  the extra sales will cover the cost!
                </div>
              </div>

              <div class="labor-options">
                <div class="labor-card" onclick="selectLabor('alone')">
                  <div class="labor-icon">üßë</div>
                  <div class="labor-content">
                    <div class="labor-name">Work Alone</div>
                    <div class="labor-cost">$0.00/month</div>
                    <ul class="labor-benefits">
                      <li>‚úì No additional costs</li>
                      <li>‚úì Keep all profits</li>
                      <li>‚ö†Ô∏è Serve 3-5 customers/hour</li>
                      <li>‚ö†Ô∏è Limited sales capacity</li>
                      <li>‚úó Can't restock while serving</li>
                    </ul>
                  </div>
                </div>

                <div class="labor-card" onclick="selectLabor('parttime')">
                  <div class="labor-icon">üë•</div>
                  <div class="labor-content">
                    <div class="labor-name">Part-Time Helper</div>
                    <div class="labor-cost">$40.00/month</div>
                    <ul class="labor-benefits">
                      <li>‚úì Serve 8-10 customers/hour</li>
                      <li>‚úì Better customer service</li>
                      <li>‚úì Can restock while selling</li>
                      <li>‚úì Good for medium traffic</li>
                      <li>‚ö†Ô∏è Moderate cost increase</li>
                    </ul>
                  </div>
                </div>

                <div class="labor-card" onclick="selectLabor('fulltime')">
                  <div class="labor-icon">üë®‚Äçüíº</div>
                  <div class="labor-content">
                    <div class="labor-name">Full-Time Assistant</div>
                    <div class="labor-cost">$80.00/month</div>
                    <ul class="labor-benefits">
                      <li>‚úì Serve 12-15 customers/hour</li>
                      <li>‚úì Excellent customer service</li>
                      <li>‚úì Handle rush periods</li>
                      <li>‚úì Focus on premium sales</li>
                      <li>‚ö†Ô∏è High cost - needs strong sales</li>
                    </ul>
                  </div>
                </div>
              </div>

              <div class="action-buttons">
                <button class="btn btn-secondary" onclick="prevStep()">
                  <span>‚Üê</span>
                  <span>Back</span>
                </button>
                <button
                  class="btn btn-primary"
                  onclick="nextStep()"
                  id="step3Next"
                  disabled=""
                >
                  <span>Continue</span>
                  <span>‚Üí</span>
                </button>
              </div>
            </div>
          </div>

          <div>
            <div class="summary-panel" id="summaryPanel3"></div>
          </div>
        </div>
      </div>

      <!-- Step 4: Pricing -->
      <div class="step-content" id="step4">
        <div style="display: grid; grid-template-columns: 1fr 400px; gap: 2rem">
          <div>
            <div class="content-card">
              <h2 class="step-title">
                <span>üíµ</span>
                <span>Set Your Prices</span>
              </h2>
              <p class="step-subtitle">
                Price each product category. Too high = fewer sales. Too low =
                less profit!
              </p>

              <div class="edu-note">
                <div class="edu-note-title">
                  <span>üí°</span>
                  <span>Business Lesson:</span>
                </div>
                <div class="edu-note-content">
                  Price sensitivity varies by product! Budget items like balls
                  are very price-sensitive. Premium items like RC cars are less
                  sensitive - quality matters more than price.
                </div>
              </div>

              <div class="pricing-grid" id="pricingGrid"></div>

              <div class="action-buttons">
                <button class="btn btn-secondary" onclick="prevStep()">
                  <span>‚Üê</span>
                  <span>Back</span>
                </button>
                <button class="btn btn-primary" onclick="nextStep()">
                  <span>Continue</span>
                  <span>‚Üí</span>
                </button>
              </div>
            </div>
          </div>

          <div>
            <div class="summary-panel" id="summaryPanel4"></div>
          </div>
        </div>
      </div>

      <!-- Step 5: Marketing -->
      <div class="step-content" id="step5">
        <div style="display: grid; grid-template-columns: 1fr 400px; gap: 2rem">
          <div>
            <div class="content-card">
              <h2 class="step-title">
                <span>üì£</span>
                <span>Marketing Strategy</span>
              </h2>
              <p class="step-subtitle">
                How will you attract customers? More marketing = more
                visibility!
              </p>

              <div class="edu-note">
                <div class="edu-note-title">
                  <span>üí°</span>
                  <span>Business Lesson:</span>
                </div>
                <div class="edu-note-content">
                  Marketing brings customers! But it costs money. Think about
                  your location and products - will the extra customers justify
                  the expense?
                </div>
              </div>

              <div class="marketing-options">
                <div class="marketing-card" onclick="selectMarketing('none')">
                  <div class="marketing-icon">ü™ü</div>
                  <div class="marketing-name">Window Display Only</div>
                  <div class="marketing-cost">$0.00</div>
                  <div class="marketing-description">
                    Attracts walk-by customers only. Relies on your location's
                    natural foot traffic.
                  </div>
                </div>

                <div class="marketing-card" onclick="selectMarketing('flyers')">
                  <div class="marketing-icon">üìÑ</div>
                  <div class="marketing-name">Flyers &amp; Coupons</div>
                  <div class="marketing-cost">$25.00</div>
                  <div class="marketing-description">
                    10% off coupon attracts budget shoppers. Great for volume
                    sales and building customer base.
                  </div>
                </div>

                <div class="marketing-card" onclick="selectMarketing('event')">
                  <div class="marketing-icon">üé™</div>
                  <div class="marketing-name">Toy Demo Day Event</div>
                  <div class="marketing-cost">$50.00</div>
                  <div class="marketing-description">
                    Big attraction with toy demonstrations. Drives serious
                    buyers, especially for expensive items.
                  </div>
                </div>
              </div>

              <div class="action-buttons">
                <button class="btn btn-secondary" onclick="prevStep()">
                  <span>‚Üê</span>
                  <span>Back</span>
                </button>
                <button
                  class="btn btn-primary"
                  onclick="calculateResults()"
                  id="step5Next"
                  disabled=""
                >
                  <span>Calculate Results</span>
                  <span>üìä</span>
                </button>
              </div>
            </div>
          </div>

          <div>
            <div class="summary-panel" id="summaryPanel5"></div>
          </div>
        </div>
      </div>

      <!-- Step 6: Results -->
      <div class="step-content" id="step6">
        <div class="results-container">
          <div class="results-header">
            <div class="results-icon" id="resultsIcon">üéâ</div>
            <h2 class="results-title" id="resultsTitle">Results Are In!</h2>
            <p class="results-subtitle" id="resultsSubtitle">
              Let's see how your toy store performed...
            </p>
            <div id="scoreBadge"></div>
          </div>

          <div class="results-grid">
            <div class="result-card">
              <div class="result-label">Total Revenue</div>
              <div class="result-value" id="totalRevenue">$0.00</div>
            </div>
            <div class="result-card">
              <div class="result-label">Total Costs</div>
              <div class="result-value" id="totalCosts">$0.00</div>
            </div>
            <div class="result-card">
              <div class="result-label">Profit/Loss</div>
              <div class="result-value" id="profitLoss">$0.00</div>
              <div class="result-change" id="profitChange"></div>
            </div>
            <div class="result-card">
              <div class="result-label">ROI</div>
              <div class="result-value" id="roi">0%</div>
            </div>
          </div>

          <div class="performance-table">
            <h3>üìä Product Performance</h3>
            <table id="productTable">
              <thead>
                <tr>
                  <th>Product</th>
                  <th>Purchased</th>
                  <th>Sold</th>
                  <th>Price</th>
                  <th>Revenue</th>
                  <th>Profit</th>
                  <th>Efficiency</th>
                </tr>
              </thead>
              <tbody id="productTableBody"></tbody>
            </table>
          </div>

          <div class="insights-section">
            <div class="insights-title">
              <span>üí°</span>
              <span>Key Insights &amp; Lessons</span>
            </div>
            <div id="insightsContainer"></div>
          </div>

          <div class="action-buttons">
            <button class="btn btn-secondary" onclick="location.reload()">
              <span>‚Ü∫</span>
              <span>Play Again</span>
            </button>
            <button
              class="btn btn-primary"
              onclick="window.location.href='games.html'"
            >
              <span>üéÆ</span>
              <span>Back to Games</span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Game State
      const gameState = {
        currentStep: 1,
        budget: 500,
        location: null,
        inventory: {
          balls: {
            qty: 0,
            cost: 1.0,
            price: 3.0,
            minPrice: 2.5,
            maxPrice: 4.0,
            appeal: [3, 4, 5, 6],
            speed: 0.9,
            sensitivity: 0.8,
          },
          plush: {
            qty: 0,
            cost: 5.0,
            price: 15.0,
            minPrice: 12.0,
            maxPrice: 18.0,
            appeal: [5, 6, 7, 8, 9, 10],
            speed: 0.7,
            sensitivity: 0.6,
          },
          games: {
            qty: 0,
            cost: 12.0,
            price: 30.0,
            minPrice: 25.0,
            maxPrice: 35.0,
            appeal: [8, 9, 10, 11, 12, 13, 14],
            speed: 0.5,
            sensitivity: 0.4,
          },
          rc: {
            qty: 0,
            cost: 25.0,
            price: 67.5,
            minPrice: 60.0,
            maxPrice: 75.0,
            appeal: [10, 11, 12, 13, 14, 15],
            speed: 0.3,
            sensitivity: 0.2,
          },
        },
        labor: null,
        marketing: null,
        locations: {
          mall: {
            rent: 200,
            traffic: 1.5,
            demographics: [3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15],
            spending: 1.3,
          },
          downtown: {
            rent: 120,
            traffic: 1.2,
            demographics: [5, 6, 7, 8, 9, 10, 11, 12],
            spending: 1.1,
          },
          neighborhood: {
            rent: 60,
            traffic: 0.8,
            demographics: [3, 4, 5, 6, 7, 8],
            spending: 0.9,
          },
        },
        laborOptions: {
          alone: { cost: 0, capacity: 4 },
          parttime: { cost: 40, capacity: 9 },
          fulltime: { cost: 80, capacity: 13 },
        },
        marketingOptions: {
          none: { cost: 0, boost: 0, discount: 0 },
          flyers: { cost: 25, boost: 0.3, discount: 0.1 },
          event: { cost: 50, boost: 0.6, discount: 0 },
        },
      };

      // Initialize
      function init() {
        updateProgress();
        updateSummary();
      }

      // Step Navigation
      function nextStep() {
        if (gameState.currentStep < 6) {
          document
            .getElementById(`step${gameState.currentStep}`)
            .classList.remove("active");
          gameState.currentStep++;
          document
            .getElementById(`step${gameState.currentStep}`)
            .classList.add("active");
          updateProgress();
          updateSummary();

          if (gameState.currentStep === 4) {
            buildPricingSection();
          }
        }
      }

      function prevStep() {
        if (gameState.currentStep > 1) {
          document
            .getElementById(`step${gameState.currentStep}`)
            .classList.remove("active");
          gameState.currentStep--;
          document
            .getElementById(`step${gameState.currentStep}`)
            .classList.add("active");
          updateProgress();
          updateSummary();
        }
      }

      function updateProgress() {
        const steps = document.querySelectorAll(".step");
        steps.forEach((step, index) => {
          const stepNum = index + 1;
          step.classList.remove("active", "completed");
          if (stepNum < gameState.currentStep) {
            step.classList.add("completed");
          } else if (stepNum === gameState.currentStep) {
            step.classList.add("active");
          }
        });

        const progress = ((gameState.currentStep - 1) / 5) * 100;
        document.getElementById("progressFill").style.width = progress + "%";
      }

      // Location Selection
      function selectLocation(location) {
        gameState.location = location;
        document.querySelectorAll(".location-card").forEach((card) => {
          card.classList.remove("selected");
        });
        event.currentTarget.classList.add("selected");
        document.getElementById("step1Next").disabled = false;
        updateSummary();
      }

      // Inventory Adjustment
      function adjustInventory(item, amount) {
        const newQty = Math.max(0, gameState.inventory[item].qty + amount);
        const cost = gameState.inventory[item].cost;
        const totalCost = getTotalCosts();
        const inventoryCost = getInventoryCost();
        const proposedCost = totalCost - inventoryCost + newQty * cost;

        if (proposedCost <= gameState.budget || amount < 0) {
          gameState.inventory[item].qty = newQty;
          updateInventoryDisplay();
          updateSummary();
        }
      }

      function updateInventoryDisplay() {
        for (let item in gameState.inventory) {
          const qty = gameState.inventory[item].qty;
          const cost = gameState.inventory[item].cost;
          document.getElementById(`${item}Qty`).textContent = qty;
          document.getElementById(`${item}Cost`).textContent = `$${(
            qty * cost
          ).toFixed(2)}`;
        }
      }

      // Labor Selection
      function selectLabor(labor) {
        gameState.labor = labor;
        document.querySelectorAll(".labor-card").forEach((card) => {
          card.classList.remove("selected");
        });
        event.currentTarget.classList.add("selected");
        document.getElementById("step3Next").disabled = false;
        document.getElementById("laborRow").style.display = "flex";
        updateSummary();
      }

      // Pricing
      function buildPricingSection() {
        const grid = document.getElementById("pricingGrid");
        grid.innerHTML = "";

        const productNames = {
          balls: "‚öΩ Rubber Balls",
          plush: "üß∏ Plush Animals",
          games: "üé≤ Board Games",
          rc: "üöó RC Cars",
        };

        for (let item in gameState.inventory) {
          if (gameState.inventory[item].qty > 0) {
            const product = gameState.inventory[item];
            const html = `
                        <div class="pricing-item">
                            <div class="pricing-header">
                                <div class="pricing-name">${
                                  productNames[item]
                                }</div>
                                <div class="pricing-value" id="${item}Price">$${product.price.toFixed(
              2
            )}</div>
                            </div>
                            <div class="slider-container">
                                <input type="range" class="slider" id="${item}Slider" 
                                    min="${product.minPrice * 100}" 
                                    max="${product.maxPrice * 100}" 
                                    value="${product.price * 100}" 
                                    step="25"
                                    oninput="updatePrice('${item}')">
                            </div>
                            <div class="price-range">
                                <span>Min: $${product.minPrice.toFixed(
                                  2
                                )}</span>
                                <span>Cost: $${product.cost.toFixed(2)}</span>
                                <span>Max: $${product.maxPrice.toFixed(
                                  2
                                )}</span>
                            </div>
                            <div class="price-status optimal" id="${item}Status">Optimal pricing!</div>
                        </div>
                    `;
            grid.innerHTML += html;
          }
        }
      }

      function updatePrice(item) {
        const value = document.getElementById(`${item}Slider`).value;
        const price = value / 100;
        gameState.inventory[item].price = price;
        document.getElementById(`${item}Price`).textContent = `$${price.toFixed(
          2
        )}`;

        const product = gameState.inventory[item];
        const statusDiv = document.getElementById(`${item}Status`);
        const optimalMin =
          product.minPrice + (product.maxPrice - product.minPrice) * 0.3;
        const optimalMax =
          product.minPrice + (product.maxPrice - product.minPrice) * 0.7;

        if (price < optimalMin) {
          statusDiv.className = "price-status low";
          statusDiv.textContent = "Priced low - less profit per sale";
        } else if (price > optimalMax) {
          statusDiv.className = "price-status high";
          statusDiv.textContent = "Priced high - fewer customers will buy";
        } else {
          statusDiv.className = "price-status optimal";
          statusDiv.textContent = "Optimal pricing!";
        }
      }

      // Marketing Selection
      function selectMarketing(marketing) {
        gameState.marketing = marketing;
        document.querySelectorAll(".marketing-card").forEach((card) => {
          card.classList.remove("selected");
        });
        event.currentTarget.classList.add("selected");
        document.getElementById("step5Next").disabled = false;
        document.getElementById("marketingRow").style.display = "flex";
        updateSummary();
      }

      // Cost Calculations
      function getInventoryCost() {
        let total = 0;
        for (let item in gameState.inventory) {
          total +=
            gameState.inventory[item].qty * gameState.inventory[item].cost;
        }
        return total;
      }

      function getTotalCosts() {
        let total = 0;
        if (gameState.location) {
          total += gameState.locations[gameState.location].rent;
        }
        total += getInventoryCost();
        if (gameState.labor) {
          total += gameState.laborOptions[gameState.labor].cost;
        }
        if (gameState.marketing) {
          total += gameState.marketingOptions[gameState.marketing].cost;
        }
        return total;
      }

      // Update Summary Panel
      function updateSummary() {
        const panels = [
          "summaryPanel",
          "summaryPanel3",
          "summaryPanel4",
          "summaryPanel5",
        ];
        panels.forEach((panelId) => {
          const panel = document.getElementById(panelId);
          if (panel) {
            const locationCost = gameState.location
              ? gameState.locations[gameState.location].rent
              : 0;
            const inventoryCost = getInventoryCost();
            const laborCost = gameState.labor
              ? gameState.laborOptions[gameState.labor].cost
              : 0;
            const marketingCost = gameState.marketing
              ? gameState.marketingOptions[gameState.marketing].cost
              : 0;
            const totalCost = getTotalCosts();
            const remaining = gameState.budget - totalCost;

            panel.innerHTML = `
                        <div class="summary-title">
                            <span>üìä</span>
                            <span>Budget Summary</span>
                        </div>
                        <div class="summary-row">
                            <span class="summary-label">Starting Budget:</span>
                            <span class="summary-value">$${gameState.budget.toFixed(
                              2
                            )}</span>
                        </div>
                        <div class="summary-row">
                            <span class="summary-label">Location Rent:</span>
                            <span class="summary-value">$${locationCost.toFixed(
                              2
                            )}</span>
                        </div>
                        <div class="summary-row">
                            <span class="summary-label">Inventory Cost:</span>
                            <span class="summary-value">$${inventoryCost.toFixed(
                              2
                            )}</span>
                        </div>
                        ${
                          gameState.labor
                            ? `
                        <div class="summary-row">
                            <span class="summary-label">Labor Cost:</span>
                            <span class="summary-value">$${laborCost.toFixed(
                              2
                            )}</span>
                        </div>`
                            : ""
                        }
                        ${
                          gameState.marketing
                            ? `
                        <div class="summary-row">
                            <span class="summary-label">Marketing Cost:</span>
                            <span class="summary-value">$${marketingCost.toFixed(
                              2
                            )}</span>
                        </div>`
                            : ""
                        }
                        <div class="summary-total">
                            <div class="summary-row">
                                <span class="summary-label">Total Costs:</span>
                                <span class="summary-value">$${totalCost.toFixed(
                                  2
                                )}</span>
                            </div>
                            <div class="summary-row">
                                <span class="summary-label">Remaining:</span>
                                <span class="summary-value" style="color: ${
                                  remaining >= 0
                                    ? "var(--success-color)"
                                    : "var(--danger-color)"
                                }">$${remaining.toFixed(2)}</span>
                            </div>
                        </div>
                        ${
                          remaining < 0
                            ? '<div class="budget-warning">‚ö†Ô∏è Over budget! Reduce costs.</div>'
                            : remaining > 200
                            ? '<div class="budget-ok">üí° You have budget left - consider more inventory or marketing!</div>'
                            : '<div class="budget-ok">‚úì Budget looks good!</div>'
                        }
                    `;
          }
        });
      }

      // Calculate Results
      function calculateResults() {
        const location = gameState.locations[gameState.location];
        const labor = gameState.laborOptions[gameState.labor];
        const marketing = gameState.marketingOptions[gameState.marketing];

        // Base customer calculation
        const baseCustomers = 100;
        const customerPool = Math.floor(
          baseCustomers * location.traffic * (1 + marketing.boost)
        );
        const hoursOpen = 8;
        const maxServed = Math.min(customerPool, labor.capacity * hoursOpen);

        const results = {
          products: {},
          totalRevenue: 0,
          totalCosts: getTotalCosts(),
          customersServed: maxServed,
        };

        // Calculate sales for each product
        for (let item in gameState.inventory) {
          const product = gameState.inventory[item];
          if (product.qty === 0) continue;

          // Calculate appeal match
          const locationAges = location.demographics;
          const productAges = product.appeal;
          const ageOverlap = locationAges.filter((age) =>
            productAges.includes(age)
          ).length;
          const appealMatch = ageOverlap / productAges.length;

          // Calculate price attractiveness
          const priceRange = product.maxPrice - product.minPrice;
          const pricePosition = (product.price - product.minPrice) / priceRange;
          const priceAttractiveness = 1 - pricePosition * product.sensitivity;

          // Apply marketing discount effect
          const discountBoost = marketing.discount > 0 ? 1.2 : 1;

          // Calculate sales probability
          const salesProbability =
            appealMatch *
            priceAttractiveness *
            product.speed *
            location.spending *
            discountBoost;

          // Calculate interested customers
          const interestedCustomers = Math.floor(
            maxServed * salesProbability * 0.5
          );

          // Actual sales
          const actualSales = Math.min(interestedCustomers, product.qty);

          // Calculate financials
          const revenue = actualSales * product.price;
          const cost = product.qty * product.cost;
          const profit = revenue - cost;
          const efficiency =
            product.qty > 0 ? (actualSales / product.qty) * 100 : 0;

          results.products[item] = {
            purchased: product.qty,
            sold: actualSales,
            unsold: product.qty - actualSales,
            price: product.price,
            revenue: revenue,
            cost: cost,
            profit: profit,
            efficiency: efficiency,
          };

          results.totalRevenue += revenue;
        }

        results.profit = results.totalRevenue - results.totalCosts;
        results.roi =
          results.totalCosts > 0
            ? (results.profit / results.totalCosts) * 100
            : 0;

        displayResults(results);
      }

      // Display Results
      function displayResults(results) {
        nextStep();

        // Update main metrics
        document.getElementById(
          "totalRevenue"
        ).textContent = `$${results.totalRevenue.toFixed(2)}`;
        document.getElementById(
          "totalCosts"
        ).textContent = `$${results.totalCosts.toFixed(2)}`;
        document.getElementById(
          "profitLoss"
        ).textContent = `$${results.profit.toFixed(2)}`;
        document.getElementById("roi").textContent = `${results.roi.toFixed(
          1
        )}%`;

        // Set profit indicator
        const profitChange = document.getElementById("profitChange");
        if (results.profit > 0) {
          profitChange.textContent = "üìà Profit!";
          profitChange.className = "result-change positive";
        } else if (results.profit < 0) {
          profitChange.textContent = "üìâ Loss";
          profitChange.className = "result-change negative";
        } else {
          profitChange.textContent = "‚û°Ô∏è Break Even";
          profitChange.className = "result-change";
        }

        // Calculate score
        let score = 0;
        const avgEfficiency =
          Object.values(results.products).reduce(
            (sum, p) => sum + p.efficiency,
            0
          ) / Object.keys(results.products).length;

        if (results.profit > 150 && avgEfficiency > 80) score = 100;
        else if (results.profit > 100 && avgEfficiency > 60) score = 80;
        else if (results.profit > 50) score = 60;
        else if (results.profit >= 0) score = 40;
        else score = 20;

        // Display score badge
        const scoreBadge = document.getElementById("scoreBadge");
        let badgeClass = "score-poor";
        let badgeText = "Needs Improvement";
        let icon = "üò¢";

        if (score >= 100) {
          badgeClass = "score-excellent";
          badgeText = "Excellent!";
          icon = "üéâ";
        } else if (score >= 80) {
          badgeClass = "score-good";
          badgeText = "Great Job!";
          icon = "üòä";
        } else if (score >= 60) {
          badgeClass = "score-average";
          badgeText = "Good Effort";
          icon = "üëç";
        }

        scoreBadge.innerHTML = `<div class="score-badge ${badgeClass}">${icon} ${badgeText} - ${score} Points</div>`;
        document.getElementById("resultsIcon").textContent = icon;

        // Product performance table
        const tbody = document.getElementById("productTableBody");
        tbody.innerHTML = "";

        const productNames = {
          balls: "‚öΩ Rubber Balls",
          plush: "üß∏ Plush Animals",
          games: "üé≤ Board Games",
          rc: "üöó RC Cars",
        };

        for (let item in results.products) {
          const p = results.products[item];
          tbody.innerHTML += `
                    <tr>
                        <td>${productNames[item]}</td>
                        <td>${p.purchased}</td>
                        <td>${p.sold}</td>
                        <td>$${p.price.toFixed(2)}</td>
                        <td>$${p.revenue.toFixed(2)}</td>
                        <td style="color: ${
                          p.profit >= 0
                            ? "var(--success-color)"
                            : "var(--danger-color)"
                        }">$${p.profit.toFixed(2)}</td>
                        <td>${p.efficiency.toFixed(0)}%</td>
                    </tr>
                `;
        }

        // Generate insights
        generateInsights(results);
      }

      // Generate Insights
      function generateInsights(results) {
        const insights = [];
        const location = gameState.locations[gameState.location];

        // Best/worst performers
        let bestProduct = null;
        let worstProduct = null;
        let bestProfit = -Infinity;
        let worstEfficiency = Infinity;

        for (let item in results.products) {
          if (results.products[item].profit > bestProfit) {
            bestProfit = results.products[item].profit;
            bestProduct = item;
          }
          if (
            results.products[item].efficiency < worstEfficiency &&
            results.products[item].purchased > 0
          ) {
            worstEfficiency = results.products[item].efficiency;
            worstProduct = item;
          }
        }

        const productNames = {
          balls: "Rubber Balls",
          plush: "Plush Animals",
          games: "Board Games",
          rc: "RC Cars",
        };

        if (bestProduct) {
          insights.push({
            icon: "üèÜ",
            title: "Best Seller",
            description: `${
              productNames[bestProduct]
            } performed best with $${results.products[
              bestProduct
            ].profit.toFixed(2)} profit. Great choice!`,
          });
        }

        if (worstProduct && worstEfficiency < 50) {
          insights.push({
            icon: "üìâ",
            title: "Slow Mover",
            description: `${
              productNames[worstProduct]
            } only sold ${worstEfficiency.toFixed(
              0
            )}%. Consider pricing lower or stocking less next time.`,
          });
        }

        // Location insights
        if (location.rent > 150 && results.profit < 100) {
          insights.push({
            icon: "üè¢",
            title: "Location Costs",
            description:
              "High rent locations need strong sales to be profitable. Make sure you have enough inventory and good prices!",
          });
        }

        // Pricing insights
        let overpriced = [];
        for (let item in results.products) {
          const product = gameState.inventory[item];
          if (
            results.products[item].efficiency < 40 &&
            product.price >
              product.minPrice + (product.maxPrice - product.minPrice) * 0.7
          ) {
            overpriced.push(productNames[item]);
          }
        }

        if (overpriced.length > 0) {
          insights.push({
            icon: "üí∞",
            title: "Price Sensitivity",
            description: `${overpriced.join(
              ", "
            )} may have been priced too high. Lower prices can increase volume!`,
          });
        }

        // Inventory efficiency
        const avgEfficiency =
          Object.values(results.products).reduce(
            (sum, p) => sum + p.efficiency,
            0
          ) / Object.keys(results.products).length;
        if (avgEfficiency > 80) {
          insights.push({
            icon: "‚ú®",
            title: "Excellent Inventory Management",
            description: `You sold ${avgEfficiency.toFixed(
              0
            )}% of your inventory! Very efficient - minimal waste.`,
          });
        } else if (avgEfficiency < 50) {
          insights.push({
            icon: "üì¶",
            title: "Unsold Inventory",
            description: `Only ${avgEfficiency.toFixed(
              0
            )}% sold. Unsold inventory ties up money. Stock less or adjust prices.`,
          });
        }

        // Overall performance
        if (results.profit > 150) {
          insights.push({
            icon: "üéØ",
            title: "Strong Performance",
            description:
              "Excellent profit! You made smart decisions balancing costs, pricing, and inventory.",
          });
        } else if (results.profit < 0) {
          insights.push({
            icon: "üí°",
            title: "Learning Opportunity",
            description:
              "You lost money this time. Try lowering rent costs, reducing inventory, or adjusting prices. Every entrepreneur learns from mistakes!",
          });
        }

        // Display insights
        const container = document.getElementById("insightsContainer");
        container.innerHTML = insights
          .map(
            (insight) => `
                <div class="insight-item">
                    <div class="insight-icon">${insight.icon}</div>
                    <div class="insight-content">
                        <div class="insight-title">${insight.title}</div>
                        <div class="insight-description">${insight.description}</div>
                    </div>
                </div>
            `
          )
          .join("");
      }

      // Initialize on load
      window.addEventListener("load", init);
    </script>
  </body>
</html>
