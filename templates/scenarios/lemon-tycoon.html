<!DOCTYPE html>
<html lang="en">
  <head>
    <meta name="x-poe-datastore-behavior" content="local_only" />
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://code.jquery.com https://unpkg.com https://d3js.org https://threejs.org https://cdn.plot.ly https://stackpath.bootstrapcdn.com https://maps.googleapis.com https://cdn.tailwindcss.com https://ajax.googleapis.com https://kit.fontawesome.com https://cdn.datatables.net https://maxcdn.bootstrapcdn.com https://code.highcharts.com https://tako-static-assets-production.s3.amazonaws.com https://www.youtube.com https://fonts.googleapis.com https://fonts.gstatic.com https://pfst.cf2.poecdn.net https://puc.poecdn.net https://i.imgur.com https://wikimedia.org https://*.icons8.com https://*.giphy.com https://picsum.photos https://images.unsplash.com; frame-src 'self' https://www.youtube.com https://trytako.com; child-src 'self'; manifest-src 'self'; worker-src 'self'; upgrade-insecure-requests; block-all-mixed-content;"
    />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lemonade Stand Tycoon - BizKids Learning Platform</title>
    <link rel="stylesheet" href="lemon-tycoon.css" />
    <script src="https://puc.poecdn.net/authenticated_preview_page/syncedState.3f7572448765332f3047.js"></script>
  </head>
  <body>
    <!-- Game Header -->
    <header class="game-header">
      <div class="header-content">
        <div class="game-title">
          <span style="font-size: 2rem">üçã</span>
          <h1>Lemonade Stand Tycoon</h1>
        </div>
        <a href="games.html" class="back-link">
          <span>‚Üê</span>
          <span>Back to Games</span>
        </a>
      </div>
    </header>

    <!-- Stats Bar -->
    <div class="stats-bar">
      <div class="stats-container">
        <div class="stat-item">
          <div class="stat-label">Cash</div>
          <div class="stat-value">
            <span>üíµ</span>
            <span id="cashDisplay">$50.00</span>
          </div>
        </div>
        <div class="stat-item">
          <div class="stat-label">Day</div>
          <div class="stat-value">
            <span>üìÖ</span>
            <span id="dayDisplay">1</span>
          </div>
        </div>
        <div class="stat-item">
          <div class="stat-label">Total Profit</div>
          <div class="stat-value">
            <span>üí∞</span>
            <span id="profitDisplay">$0.00</span>
          </div>
          <div class="stat-change positive" id="profitChange"></div>
        </div>
        <div class="stat-item">
          <div class="stat-label">Cups Sold</div>
          <div class="stat-value">
            <span>ü•§</span>
            <span id="cupsSoldDisplay">0</span>
          </div>
        </div>
        <div class="stat-item">
          <div class="stat-label">Reputation</div>
          <div class="stat-value">
            <span>‚≠ê</span>
            <span id="reputationDisplay">5.0</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Game Area -->
    <div class="game-container">
      <!-- Game Board -->
      <div class="game-board">
        <div class="board-header">
          <div class="day-info">
            <div class="day-number">Day <span id="currentDay">1</span></div>
          </div>
          <div class="weather-info">
            <span class="weather-icon" id="weatherIcon">‚òÄÔ∏è</span>
            <span id="weatherText">Sunny &amp; Hot</span>
            <span id="temperature">85¬∞F</span>
          </div>
        </div>

        <!-- Inventory Section -->
        <div class="control-section">
          <div class="section-title">
            <span>üì¶</span>
            <span>Buy Supplies</span>
          </div>
          <div class="control-grid">
            <div class="control-card">
              <div class="control-label">
                <span>üçã</span>
                <span>Lemons</span>
              </div>
              <div class="control-input">
                <button
                  class="quantity-btn"
                  onclick="adjustQuantity('lemons', -10)"
                >
                  -
                </button>
                <div class="quantity-display" id="lemonsQty">0</div>
                <button
                  class="quantity-btn"
                  onclick="adjustQuantity('lemons', 10)"
                >
                  +
                </button>
              </div>
              <div class="cost-info">
                <span>$0.50 per 10</span>
                <span id="lemonsCost">$0.00</span>
              </div>
            </div>

            <div class="control-card">
              <div class="control-label">
                <span>üßÇ</span>
                <span>Sugar</span>
              </div>
              <div class="control-input">
                <button
                  class="quantity-btn"
                  onclick="adjustQuantity('sugar', -10)"
                >
                  -
                </button>
                <div class="quantity-display" id="sugarQty">0</div>
                <button
                  class="quantity-btn"
                  onclick="adjustQuantity('sugar', 10)"
                >
                  +
                </button>
              </div>
              <div class="cost-info">
                <span>$0.30 per 10</span>
                <span id="sugarCost">$0.00</span>
              </div>
            </div>

            <div class="control-card">
              <div class="control-label">
                <span>ü•§</span>
                <span>Cups</span>
              </div>
              <div class="control-input">
                <button
                  class="quantity-btn"
                  onclick="adjustQuantity('cups', -10)"
                >
                  -
                </button>
                <div class="quantity-display" id="cupsQty">0</div>
                <button
                  class="quantity-btn"
                  onclick="adjustQuantity('cups', 10)"
                >
                  +
                </button>
              </div>
              <div class="cost-info">
                <span>$0.20 per 10</span>
                <span id="cupsCost">$0.00</span>
              </div>
            </div>

            <div class="control-card">
              <div class="control-label">
                <span>üßä</span>
                <span>Ice</span>
              </div>
              <div class="control-input">
                <button
                  class="quantity-btn"
                  onclick="adjustQuantity('ice', -10)"
                >
                  -
                </button>
                <div class="quantity-display" id="iceQty">0</div>
                <button
                  class="quantity-btn"
                  onclick="adjustQuantity('ice', 10)"
                >
                  +
                </button>
              </div>
              <div class="cost-info">
                <span>$0.10 per 10</span>
                <span id="iceCost">$0.00</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Pricing Section -->
        <div class="control-section">
          <div class="section-title">
            <span>üíµ</span>
            <span>Set Your Price</span>
          </div>
          <div class="control-card">
            <div class="control-label">
              <span>Price per Cup</span>
            </div>
            <div class="slider-container">
              <input
                type="range"
                class="slider"
                id="priceSlider"
                min="25"
                max="500"
                value="100"
                step="25"
                oninput="updatePrice()"
              />
            </div>
            <div style="text-align: center; margin-top: 1rem">
              <div
                style="
                  font-size: 2.5rem;
                  font-weight: 800;
                  color: var(--primary-color);
                "
                id="priceDisplay"
              >
                $1.00
              </div>
              <div style="font-size: 0.875rem; color: var(--text-secondary)">
                Recommended: $0.75 - $1.25
              </div>
            </div>
          </div>
        </div>

        <!-- Recipe Quality -->
        <div class="control-section">
          <div class="section-title">
            <span>üë®‚Äçüç≥</span>
            <span>Recipe Quality</span>
          </div>
          <div class="control-card">
            <div class="control-label">
              <span>Lemon-to-Sugar Ratio</span>
            </div>
            <div class="slider-container">
              <input
                type="range"
                class="slider"
                id="recipeSlider"
                min="1"
                max="10"
                value="5"
                oninput="updateRecipe()"
              />
            </div>
            <div style="text-align: center; margin-top: 1rem">
              <div
                style="font-weight: 700; color: var(--primary-color)"
                id="recipeQuality"
              >
                Balanced
              </div>
              <div
                style="
                  font-size: 0.75rem;
                  color: var(--text-secondary);
                  margin-top: 0.5rem;
                "
              >
                <span style="float: left">üçã Sour</span>
                <span style="float: right">Sweet üßÇ</span>
              </div>
              <div style="clear: both"></div>
            </div>
          </div>
        </div>

        <!-- Total Cost -->
        <div
          style="
            background: var(--background);
            padding: 1.5rem;
            border-radius: 12px;
            margin-top: 2rem;
          "
        >
          <div
            style="
              display: flex;
              justify-content: space-between;
              align-items: center;
            "
          >
            <div>
              <div style="font-size: 0.875rem; color: var(--text-secondary)">
                Total Supplies Cost
              </div>
              <div
                style="
                  font-size: 2rem;
                  font-weight: 800;
                  color: var(--primary-color);
                "
                id="totalCost"
              >
                $0.00
              </div>
            </div>
            <div>
              <div style="font-size: 0.875rem; color: var(--text-secondary)">
                Remaining Cash
              </div>
              <div style="font-size: 2rem; font-weight: 800" id="remainingCash">
                $50.00
              </div>
            </div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
          <button class="btn btn-secondary" onclick="resetDay()">
            <span>‚Ü∫</span>
            <span>Reset</span>
          </button>
          <button class="btn btn-primary" onclick="startDay()">
            <span>‚ñ∂</span>
            <span>Start Selling!</span>
          </button>
        </div>
      </div>

      <!-- Sidebar -->
      <div class="sidebar">
        <!-- Current Event -->
        <div class="info-panel">
          <div class="panel-title">
            <span>üì¢</span>
            <span>Today's Event</span>
          </div>
          <div class="event-card" id="eventCard">
            <div class="event-title">Perfect Weather!</div>
            <div class="event-description">
              It's a beautiful sunny day. People are looking for refreshing
              drinks!
            </div>
          </div>
        </div>

        <!-- Tips -->
        <div class="info-panel">
          <div class="panel-title">
            <span>üí°</span>
            <span>Pro Tips</span>
          </div>
          <ul class="tips-list">
            <li class="tip-item">
              <span class="tip-icon">‚òÄÔ∏è</span>
              <span
                >Hot weather means more customers! Stock up on supplies.</span
              >
            </li>
            <li class="tip-item">
              <span class="tip-icon">üí∞</span>
              <span
                >Don't overprice! Find the sweet spot to maximize sales.</span
              >
            </li>
            <li class="tip-item">
              <span class="tip-icon">‚≠ê</span>
              <span
                >Good recipes build reputation and bring repeat customers.</span
              >
            </li>
            <li class="tip-item">
              <span class="tip-icon">üìä</span>
              <span
                >Track your daily performance to improve your strategy.</span
              >
            </li>
          </ul>
        </div>

        <!-- Sales History -->
        <div class="info-panel">
          <div class="panel-title">
            <span>üìä</span>
            <span>Sales History</span>
          </div>
          <div class="chart-container" id="salesChart">
            <div
              style="
                text-align: center;
                width: 100%;
                color: var(--text-secondary);
                font-size: 0.875rem;
              "
            >
              No sales data yet. Start your first day!
            </div>
          </div>
        </div>

        <!-- Inventory Status -->
        <div class="info-panel">
          <div class="panel-title">
            <span>üì¶</span>
            <span>Current Inventory</span>
          </div>
          <div id="inventoryStatus">
            <div
              style="
                color: var(--text-secondary);
                font-size: 0.875rem;
                text-align: center;
              "
            >
              Buy supplies to see your inventory
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Results Modal -->
    <div class="modal" id="resultsModal">
      <div class="modal-content">
        <div class="modal-icon" id="resultIcon">üéâ</div>
        <h2 class="modal-title" id="resultTitle">Day Complete!</h2>
        <p
          id="resultMessage"
          style="color: var(--text-secondary); margin-bottom: 2rem"
        ></p>

        <div class="results-grid">
          <div class="result-item">
            <div class="result-label">Cups Sold</div>
            <div class="result-value" id="resultCupsSold">0</div>
          </div>
          <div class="result-item">
            <div class="result-label">Revenue</div>
            <div class="result-value" id="resultRevenue">$0.00</div>
          </div>
          <div class="result-item">
            <div class="result-label">Expenses</div>
            <div class="result-value" id="resultExpenses">$0.00</div>
          </div>
          <div class="result-item">
            <div class="result-label">Profit</div>
            <div class="result-value" id="resultProfit">$0.00</div>
          </div>
        </div>

        <div class="action-buttons" style="margin-top: 2rem">
          <button class="btn btn-secondary" onclick="endGame()">
            <span>üèÅ</span>
            <span>End Game</span>
          </button>
          <button class="btn btn-primary" onclick="nextDay()">
            <span>‚Üí</span>
            <span>Next Day</span>
          </button>
        </div>
      </div>
    </div>

    <script>
      // Game State
      let gameState = {
        cash: 50,
        day: 1,
        totalProfit: 0,
        reputation: 5.0,
        totalCupsSold: 0,
        inventory: {
          lemons: 0,
          sugar: 0,
          cups: 0,
          ice: 0,
        },
        price: 1.0,
        recipe: 5,
        salesHistory: [],
        weather: {
          type: "sunny",
          temperature: 85,
          modifier: 1.5,
        },
      };

      const prices = {
        lemons: 0.05,
        sugar: 0.03,
        cups: 0.02,
        ice: 0.01,
      };

      // Initialize game
      function initGame() {
        updateDisplay();
        generateWeather();
        generateEvent();
      }

      // Adjust quantities
      function adjustQuantity(item, amount) {
        const currentQty = gameState.inventory[item];
        const newQty = Math.max(0, currentQty + amount);
        const cost = (newQty - currentQty) * prices[item];

        if (gameState.cash >= cost || amount < 0) {
          gameState.inventory[item] = newQty;
          gameState.cash -= cost;
          updateDisplay();
        } else {
          alert("Not enough cash!");
        }
      }

      // Update price
      function updatePrice() {
        const value = document.getElementById("priceSlider").value;
        gameState.price = value / 100;
        document.getElementById("priceDisplay").textContent =
          "$" + gameState.price.toFixed(2);
      }

      // Update recipe
      function updateRecipe() {
        const value = document.getElementById("recipeSlider").value;
        gameState.recipe = parseInt(value);

        let quality = "Balanced";
        if (value < 3) quality = "Very Sour üòñ";
        else if (value < 5) quality = "Slightly Sour";
        else if (value == 5) quality = "Perfect! ‚≠ê";
        else if (value < 8) quality = "Slightly Sweet";
        else quality = "Too Sweet üç¨";

        document.getElementById("recipeQuality").textContent = quality;
      }

      // Generate weather
      function generateWeather() {
        const weathers = [
          {
            type: "sunny",
            icon: "‚òÄÔ∏è",
            text: "Sunny & Hot",
            temp: 85,
            modifier: 1.5,
          },
          {
            type: "partly",
            icon: "‚õÖ",
            text: "Partly Cloudy",
            temp: 75,
            modifier: 1.2,
          },
          {
            type: "cloudy",
            icon: "‚òÅÔ∏è",
            text: "Cloudy",
            temp: 70,
            modifier: 0.9,
          },
          { type: "rainy", icon: "üåßÔ∏è", text: "Rainy", temp: 65, modifier: 0.5 },
        ];

        const weather = weathers[Math.floor(Math.random() * weathers.length)];
        gameState.weather = weather;

        document.getElementById("weatherIcon").textContent = weather.icon;
        document.getElementById("weatherText").textContent = weather.text;
        document.getElementById("temperature").textContent =
          weather.temp + "¬∞F";
      }

      // Generate event
      function generateEvent() {
        const events = [
          {
            title: "Perfect Weather!",
            desc: "It's a beautiful sunny day. People are looking for refreshing drinks!",
          },
          {
            title: "Local Fair Nearby",
            desc: "There's a fair in town! Expect more foot traffic today.",
          },
          {
            title: "Hot Day Alert",
            desc: "Temperature is soaring! People will pay more for cold drinks.",
          },
          {
            title: "Weekend Rush",
            desc: "It's the weekend! Families are out and about.",
          },
          {
            title: "Slow Day",
            desc: "Not many people around today. Keep costs low!",
          },
        ];

        const event = events[Math.floor(Math.random() * events.length)];
        document.getElementById("eventCard").innerHTML = `
                <div class="event-title">${event.title}</div>
                <div class="event-description">${event.desc}</div>
            `;
      }

      // Start day
      function startDay() {
        const supplies = gameState.inventory;
        const minSupplies = Math.min(
          Math.floor(supplies.lemons / 2),
          Math.floor(supplies.sugar / 2),
          supplies.cups,
          Math.floor(supplies.ice / 3)
        );

        if (minSupplies === 0) {
          alert(
            "You need supplies to make lemonade! Buy lemons, sugar, cups, and ice."
          );
          return;
        }

        // Simulate sales
        const baseCustomers = Math.floor(Math.random() * 50 + 30);
        const weatherCustomers = Math.floor(
          baseCustomers * gameState.weather.modifier
        );

        // Price affects demand
        let priceModifier = 1.0;
        if (gameState.price < 0.75) priceModifier = 1.3;
        else if (gameState.price > 1.25) priceModifier = 0.6;
        else if (gameState.price > 1.5) priceModifier = 0.3;

        // Recipe affects satisfaction
        let recipeModifier = 1.0;
        if (gameState.recipe === 5) recipeModifier = 1.2;
        else if (gameState.recipe < 3 || gameState.recipe > 7)
          recipeModifier = 0.7;

        const totalCustomers = Math.floor(
          weatherCustomers * priceModifier * recipeModifier
        );
        const cupsSold = Math.min(totalCustomers, minSupplies);

        // Calculate results
        const revenue = cupsSold * gameState.price;
        const suppliesCost = getTotalCost();
        const profit = revenue - suppliesCost;

        // Update inventory
        gameState.inventory.lemons -= cupsSold * 2;
        gameState.inventory.sugar -= cupsSold * 2;
        gameState.inventory.cups -= cupsSold;
        gameState.inventory.ice -= cupsSold * 3;

        // Update stats
        gameState.cash += revenue;
        gameState.totalProfit += profit;
        gameState.totalCupsSold += cupsSold;

        // Update reputation
        if (gameState.recipe === 5 && gameState.price <= 1.25) {
          gameState.reputation = Math.min(5.0, gameState.reputation + 0.1);
        } else if (
          gameState.price > 1.5 ||
          gameState.recipe < 3 ||
          gameState.recipe > 7
        ) {
          gameState.reputation = Math.max(1.0, gameState.reputation - 0.1);
        }

        // Store sales data
        gameState.salesHistory.push({
          day: gameState.day,
          cupsSold: cupsSold,
          revenue: revenue,
          profit: profit,
        });

        // Show results
        showResults(cupsSold, revenue, suppliesCost, profit);
      }

      // Show results
      function showResults(cupsSold, revenue, expenses, profit) {
        document.getElementById("resultCupsSold").textContent = cupsSold;
        document.getElementById("resultRevenue").textContent =
          "$" + revenue.toFixed(2);
        document.getElementById("resultExpenses").textContent =
          "$" + expenses.toFixed(2);
        document.getElementById("resultProfit").textContent =
          "$" + profit.toFixed(2);

        if (profit > 0) {
          document.getElementById("resultIcon").textContent = "üéâ";
          document.getElementById("resultTitle").textContent = "Great Job!";
          document.getElementById("resultMessage").textContent =
            "You made a profit today! Keep up the good work.";
        } else if (profit === 0) {
          document.getElementById("resultIcon").textContent = "üòê";
          document.getElementById("resultTitle").textContent = "Break Even";
          document.getElementById("resultMessage").textContent =
            "You broke even today. Try to improve your strategy!";
        } else {
          document.getElementById("resultIcon").textContent = "üò¢";
          document.getElementById("resultTitle").textContent = "Lost Money";
          document.getElementById("resultMessage").textContent =
            "You lost money today. Adjust your prices and costs!";
        }

        document.getElementById("resultsModal").classList.add("active");
      }

      // Next day
      function nextDay() {
        gameState.day++;
        document.getElementById("resultsModal").classList.remove("active");
        generateWeather();
        generateEvent();
        resetInventoryPurchases();
        updateDisplay();
        updateSalesChart();
      }

      // Reset day
      function resetDay() {
        resetInventoryPurchases();
        updateDisplay();
      }

      // Reset inventory purchases
      function resetInventoryPurchases() {
        // This would reset the purchase interface, not the actual inventory
        updateDisplay();
      }

      // End game
      function endGame() {
        const totalDays = gameState.day;
        const avgProfit = (gameState.totalProfit / totalDays).toFixed(2);

        if (
          confirm(
            `Game Over!\n\nTotal Days: ${totalDays}\nTotal Profit: $${gameState.totalProfit.toFixed(
              2
            )}\nAverage Profit: $${avgProfit}\nTotal Cups Sold: ${
              gameState.totalCupsSold
            }\n\nPlay again?`
          )
        ) {
          location.reload();
        } else {
          window.location.href = "games.html";
        }
      }

      // Get total cost
      function getTotalCost() {
        let total = 0;
        for (let item in gameState.inventory) {
          total += gameState.inventory[item] * prices[item];
        }
        return total;
      }

      // Update display
      function updateDisplay() {
        document.getElementById("cashDisplay").textContent =
          "$" + gameState.cash.toFixed(2);
        document.getElementById("dayDisplay").textContent = gameState.day;
        document.getElementById("currentDay").textContent = gameState.day;
        document.getElementById("profitDisplay").textContent =
          "$" + gameState.totalProfit.toFixed(2);
        document.getElementById("cupsSoldDisplay").textContent =
          gameState.totalCupsSold;
        document.getElementById("reputationDisplay").textContent =
          gameState.reputation.toFixed(1);

        // Update quantities
        document.getElementById("lemonsQty").textContent =
          gameState.inventory.lemons;
        document.getElementById("sugarQty").textContent =
          gameState.inventory.sugar;
        document.getElementById("cupsQty").textContent =
          gameState.inventory.cups;
        document.getElementById("iceQty").textContent = gameState.inventory.ice;

        // Update costs
        document.getElementById("lemonsCost").textContent =
          "$" + (gameState.inventory.lemons * prices.lemons).toFixed(2);
        document.getElementById("sugarCost").textContent =
          "$" + (gameState.inventory.sugar * prices.sugar).toFixed(2);
        document.getElementById("cupsCost").textContent =
          "$" + (gameState.inventory.cups * prices.cups).toFixed(2);
        document.getElementById("iceCost").textContent =
          "$" + (gameState.inventory.ice * prices.ice).toFixed(2);

        const totalCost = getTotalCost();
        document.getElementById("totalCost").textContent =
          "$" + totalCost.toFixed(2);
        document.getElementById("remainingCash").textContent =
          "$" + (gameState.cash - totalCost).toFixed(2);

        // Update inventory status
        updateInventoryStatus();
      }

      // Update inventory status
      function updateInventoryStatus() {
        const inv = gameState.inventory;
        const html = `
                <div style="display: grid; gap: 0.5rem;">
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem; background: var(--background); border-radius: 6px;">
                        <span>üçã Lemons</span>
                        <span style="font-weight: 700;">${inv.lemons}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem; background: var(--background); border-radius: 6px;">
                        <span>üßÇ Sugar</span>
                        <span style="font-weight: 700;">${inv.sugar}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem; background: var(--background); border-radius: 6px;">
                        <span>ü•§ Cups</span>
                        <span style="font-weight: 700;">${inv.cups}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem; background: var(--background); border-radius: 6px;">
                        <span>üßä Ice</span>
                        <span style="font-weight: 700;">${inv.ice}</span>
                    </div>
                </div>
            `;
        document.getElementById("inventoryStatus").innerHTML = html;
      }

      // Update sales chart
      function updateSalesChart() {
        const history = gameState.salesHistory.slice(-7);
        if (history.length === 0) return;

        const maxSales = Math.max(...history.map((d) => d.cupsSold));

        let html = "";
        history.forEach((data, index) => {
          const height = (data.cupsSold / maxSales) * 100;
          html += `
                    <div style="flex: 1; display: flex; flex-direction: column; align-items: center;">
                        <div class="chart-bar" style="height: ${height}%" title="Day ${data.day}: ${data.cupsSold} cups"></div>
                        <div class="chart-label">D${data.day}</div>
                    </div>
                `;
        });

        document.getElementById("salesChart").innerHTML = html;
      }

      // Initialize on load
      window.addEventListener("load", initGame);
    </script>
  </body>
</html>
