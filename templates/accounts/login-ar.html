{% extends "base.html" %}
{% load static %}

{% block title %}ุชุณุฌูู ุงูุฏุฎูู{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/accounts/login.css' %}" />
{% endblock %}

{% block content %}
<div class="login-container">
  <div class="form-section">
    <h1>
      <span>๐</span>
      ูุฑุญุจุงู ุจุนูุฏุชู!
    </h1>
    <p class="subtitle">ุณุฌู ุงูุฏุฎูู ููุชุงุจุนุฉ ูุบุงูุฑุชู ุงููุงููุฉ</p>

    {% include 'partials/_alerts.html' %}

    <form method="post" action="{% url 'accounts:login' %}" id="loginForm">
      {% csrf_token %}
      
      <div class="form-group">
        <label for="username">ุงูุจุฑูุฏ ุงูุฅููุชุฑููู/ุงุณู ุงููุณุชุฎุฏู</label>
        <input
          type="text"
          id="username"
          name="username"
          required
          placeholder="ุฃุฏุฎู ุจุฑูุฏู ุงูุฅููุชุฑููู ุฃู ุงุณู ุงููุณุชุฎุฏู"
          autocomplete="username"
          value="{{ request.POST.username|default:'' }}"
        />
        <span class="input-icon" id="usernameIcon">๐ค</span>
        <div class="error-message" id="usernameError">
          ุงูุฑุฌุงุก ุฅุฏุฎุงู ุจุฑูุฏ ุฅููุชุฑููู ุฃู ุงุณู ูุณุชุฎุฏู ุตุญูุญ
        </div>
      </div>

      <div class="form-group password-container">
        <label for="password">ูููุฉ ุงููุฑูุฑ</label>
        <input
          type="password"
          id="password"
          name="password"
          required
          placeholder="ุฃุฏุฎู ูููุฉ ุงููุฑูุฑ"
          autocomplete="current-password"
        />
        <span class="toggle-password" id="togglePassword">๐๏ธ</span>
        <div class="error-message" id="passwordError">
          ุงูุฑุฌุงุก ุฅุฏุฎุงู ูููุฉ ุงููุฑูุฑ
        </div>
      </div>

      <div class="form-options">
        <div class="checkbox-group">
          <input type="checkbox" id="remember" name="remember" />
          <label for="remember">ุชุฐูุฑูู</label>
        </div>
        <div class="forgot-password">
          <a href="#forgot">ูุณูุช ูููุฉ ุงููุฑูุฑุ</a>
        </div>
      </div>

      <button type="submit" class="login-btn" id="loginBtn">
        <span class="btn-text">ุชุณุฌูู ุงูุฏุฎูู</span>
        <span class="spinner"></span>
      </button>
    </form>

    <div class="signup-link">
      ููุณ ูุฏูู ุญุณุงุจุ
      <a href="{% url 'accounts:register' %}">ุณุฌู ุงูุขู</a>
    </div>

    <div class="welcome-message">
      <h3>๐ ุงูุถู ุฅูู ูุบุงูุฑุฉ ุงูุชุนูู ุงููุงูู!</h3>
      <p>
        ุชุนูู ููุงุฑุงุช ุฅุฏุงุฑุฉ ุงููุงู ุจุทุฑููุฉ ููุชุนุฉ ูุขููุฉ. ุงุจุฏุฃ ุฑุญูุชู ูุญู ุงูุฐูุงุก
        ุงููุงูู ุงูููู!
      </p>
    </div>

    <div class="features-list">
      <div class="feature-item">
        <div class="feature-icon">๐ฎ</div>
        <div class="feature-title">ุฃูุนุงุจ ุชูุงุนููุฉ</div>
        <div class="feature-desc">ุชุนูู ูู ุฎูุงู ุงููุนุจ ูุงููุฑุญ</div>
      </div>
      <div class="feature-item">
        <div class="feature-icon">๐</div>
        <div class="feature-title">ุชุชุจุน ุงูุชูุฏู</div>
        <div class="feature-desc">ุฑุงูุจ ุฅูุฌุงุฒุงุชู ููููู</div>
      </div>
      <div class="feature-item">
        <div class="feature-icon">๐</div>
        <div class="feature-title">ููุงูุขุช ูุดุงุฑุงุช</div>
        <div class="feature-desc">ุงุญุตู ุนูู ุฌูุงุฆุฒ ุนูุฏ ุงูุชูุฏู</div>
      </div>
      <div class="feature-item">
        <div class="feature-icon">๐</div>
        <div class="feature-title">ุจูุฆุฉ ุขููุฉ</div>
        <div class="feature-desc">ูุญุชูู ููุงุณุจ ููุฃุทูุงู</div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  // Toggle password visibility
  const togglePassword = document.getElementById("togglePassword");
  const passwordInput = document.getElementById("password");

  togglePassword.addEventListener("click", () => {
    const type = passwordInput.type === "password" ? "text" : "password";
    passwordInput.type = type;
    togglePassword.textContent = type === "password" ? "๐๏ธ" : "๐";
  });

  // Form validation
  const loginForm = document.getElementById("loginForm");
  const usernameInput = document.getElementById("username");
  const loginBtn = document.getElementById("loginBtn");
  const usernameError = document.getElementById("usernameError");
  const passwordError = document.getElementById("passwordError");
  const usernameIcon = document.getElementById("usernameIcon");

  // Real-time username validation
  usernameInput.addEventListener("input", () => {
    const value = usernameInput.value.trim();
    if (value.length > 0) {
      if (validateEmail(value) || value.length >= 3) {
        usernameInput.style.borderColor = "var(--success)";
        usernameIcon.textContent = "โ";
        usernameIcon.classList.add("success-icon");
        usernameIcon.classList.remove("error-icon");
        usernameError.classList.remove("show");
      } else {
        usernameInput.style.borderColor = "var(--error)";
        usernameIcon.textContent = "โ";
        usernameIcon.classList.add("error-icon");
        usernameIcon.classList.remove("success-icon");
      }
    } else {
      usernameInput.style.borderColor = "var(--border)";
      usernameIcon.textContent = "๐ค";
      usernameIcon.classList.remove("success-icon", "error-icon");
    }
  });

  // Email validation helper
  function validateEmail(email) {
    return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
  }

  // Form submission
  loginForm.addEventListener("submit", (e) => {
    const username = usernameInput.value.trim();
    const password = passwordInput.value;

    let isValid = true;

    // Validate username
    if (!username || (!validateEmail(username) && username.length < 3)) {
      usernameError.classList.add("show");
      usernameInput.style.borderColor = "var(--error)";
      isValid = false;
      e.preventDefault();
    } else {
      usernameError.classList.remove("show");
    }

    // Validate password
    if (!password) {
      passwordError.classList.add("show");
      passwordInput.style.borderColor = "var(--error)";
      isValid = false;
      e.preventDefault();
    } else {
      passwordError.classList.remove("show");
    }

    if (!isValid) {
      loginForm.classList.add("shake");
      setTimeout(() => loginForm.classList.remove("shake"), 500);
      return;
    }

    // Add loading state
    loginBtn.classList.add("loading");
    loginBtn.disabled = true;
  });

  // Remember me functionality
  const rememberCheckbox = document.getElementById("remember");

  // Load saved username if exists
  window.addEventListener("load", () => {
    const savedUsername = localStorage.getItem("rememberedUsername");
    if (savedUsername) {
      usernameInput.value = savedUsername;
      rememberCheckbox.checked = true;
    }
  });

  // Save username if remember me is checked
  loginForm.addEventListener("submit", () => {
    if (rememberCheckbox.checked) {
      localStorage.setItem("rememberedUsername", usernameInput.value);
    } else {
      localStorage.removeItem("rememberedUsername");
    }
  });
</script>
{% endblock %}